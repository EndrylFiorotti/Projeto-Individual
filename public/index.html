<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/livros.css">
    <link rel="stylesheet" href="css/destaques.css">
    <link rel="stylesheet" href="css/index.css">
    <title>BooKing | Inicio </title>

    <script type="text/javascript" src="https://www.chartjs.org/dist/2.8.0/Chart.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> -->
</head>

<body>
    <div class="header">
        <div class="nav">
            <img src="https://cdn.discordapp.com/attachments/882040460011520030/974813802757521478/Logo_Preto_Coroa.png"
                alt="Logo BooKing">
            <ul class="navbar">
                <li><a href="#">inicio</a></li>
                <li><a href="#DestaquesTitulo">Destaques</a></li>
                <li><a href="#livrosTitulo">Livros</a></li>
                <li><a href="./login.html">Login</a></li>
            </ul>
        </div>
    </div>
    <div class="banner">
        <div class="container">
            <div class="caixa">
                <p>
                    Uma livraria para você.
                </p>
            </div>
        </div>
    </div>

    <div class="container first">
        <div class="card explicacao">
            <div class="pagina primeira">
                <p>
                    Criei a BooKing por minha paixão a livros, desde novo tive contato com pessoas que liam e que me
                    incentivavam a ler mais e mais livros, o primeiro livro que eu li, foi a recomendação de um amigo
                    meu do ensino fundamental, ali eu descobri um mundo a parte do meu, onde eu poderia fugir um pouco
                    da minha realidade e meu dia a dia, então criei a BooKing para pessoas que querem dar suas opiniões
                    e críticas a respeito dos livros que elas leram e que elas possam recomendá-los para outras pessoas.

                </p>
            </div>
            <div class="pagina segunda"></div>
        </div>
    </div>

    <div class="container second">
        <div class="card dashboard">
            <div class="pagina primeira">
                <canvas id="canvas_grafico"></canvas>
            </div>
            <div class="pagina segunda"></div>
        </div>
    </div>

    <div class="footer">
        <div class="container">
            <div class="content">
                <div class="subContent">
                    <img src="" style="width: 40px">
                    <p>Praça da República, 178, República - SP</p>
                </div>
                <div class="subContent">
                    <img src="" style="width: 40px">
                    <p>(11) 3789-9932</p>
                </div>
                <div class="subContent">
                    <img src="" style="width: 40px">
                    <p>suporte.booking@sptech.school</p>
                </div>
            </div>
            <div class="content">
                <ul class="navbar">
                    <li>
                        <a href="#">Inicio</a>
                    </li>
                    <li>
                        <a href="#DestaquesTitulo">Destaques</a>
                    </li>
                    <li>
                        <a href="#livrosTitulo">Livros</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="direitos">
            <p>Todos os direitos reservados BooKing © 2022</p>
        </div>
    </div>
</body>

</html>

<!-- <script src="js/dashboardLivros.js"></script> -->
<script>
    window.onload = obterDados();

function obterDados() {
    fetch(`/dashboard/dashboardDados`, { cache: 'no-store' }).then(function (response) {
        if (response.ok) {
            response.json().then(function (resposta) {
                console.log(`Dados recebidos: ${JSON.stringify(resposta)}`);
                resposta.reverse();

                plotar(resposta);
            });
        } else {
            console.error('Nenhum dado encontrado ou erro na API');
        }
    })
        .catch(function (error) {
            console.error(`Erro na obtenção dos dados p/ gráfico: ${error.message}`);
        });
}

function plotar(resposta) {
    console.log('iniciando plotagem do gráfico...');

    var dados = {
        labels: "Quantidade",
        datasets: [
            {
                yAxisID: 'y-quantidadeLivros',
                label: 'Quantidade de livros',
                borderColor: '#32B9CD',
                backgroundColor: '#32b9cd8f',
                fill: true,
                data: []
            }
        ]
    };

    for (i = 0; i < resposta.length; i++) {
        var registro = resposta[i];
        dados.datasets[0].data.push(registro.qntdLivros);
    }

    console.log(JSON.stringify(dados));

    const ctx = document.getElementById('canvas_grafico').getContext('2d');
    const myChart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: "Teste",
        datasets: [{
            label: 'Quantidade',
            data: dados,
            backgroundColor: [
                'rgba(255, 0, 0, 0.2)'
            ],
            borderColor: [
                'rgba(255, 0, 0, 1)'
            ],
            borderWidth: 1
        }]
    },
    options: {
        scales: {
            y: {
                beginAtZero: true
            }
        }
    }
});
}
</script>